<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login / Register - Tention Free</title>
    <meta name="description"
        content="Login to your Tention Free account to manage your orders, view purchase history, and access your digital subscriptions.">
    <meta name="robots" content="noindex, follow"> <!-- Don't index login page but follow links -->
    <link rel="canonical" href="https://tentionfree.store/login.html">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tentionfree.store/login.html">
    <meta property="og:title" content="Login - Tention Free">
    <meta property="og:description" content="Access your trusted digital shop account.">
    <meta property="og:image" content="https://tentionfree.store/images/og-image.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    colors: {
                        brand: { 400: '#3b82f6', 500: '#2563eb', 600: '#1d4ed8' },
                        dark: { bg: '#0f172a', card: '#1e293b' }
                    },
                    animation: { 'float': 'float 6s ease-in-out infinite' },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-20px)' } }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #020617;
            background-image:
                radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(147, 51, 234, 0.15) 0px, transparent 50%);
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .input-glass {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }

        .input-glass:focus {
            background: rgba(15, 23, 42, 0.9);
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
            outline: none;
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4 relative overflow-hidden">

    <!-- Floating Background Elements -->
    <div class="absolute top-20 left-20 w-72 h-72 bg-blue-600/20 rounded-full blur-[100px] animate-float"></div>
    <div class="absolute bottom-20 right-20 w-96 h-96 bg-purple-600/20 rounded-full blur-[100px] animate-float"
        style="animation-delay: -2s;"></div>

    <div class="relative w-full max-w-md">
        <!-- Brand Header -->
        <div class="text-center mb-8">
            <a href="index.html" class="inline-flex items-center group cursor-pointer">
                <div
                    class="w-12 h-12 rounded-xl bg-gradient-to-br from-brand-400 to-blue-600 flex items-center justify-center mr-3 shadow-lg shadow-brand-500/30 group-hover:shadow-brand-500/40 transition-all">
                    <i class="fa-solid fa-bolt text-white text-2xl"></i>
                </div>
                <span
                    class="text-3xl font-bold text-slate-200 tracking-tight group-hover:text-brand-600 transition-colors">Tention<span
                        class="text-brand-500">Free</span></span>
            </a>
        </div>

        <!-- Auth Card -->
        <div class="glass-card rounded-3xl p-8 shadow-2xl relative overflow-hidden">
            <!-- Top Glow Line -->
            <div
                class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-brand-400 to-transparent opacity-50">
            </div>

            <!-- Tabs -->
            <div class="flex p-1 bg-slate-900/50 rounded-xl mb-8 relative">
                <div id="tab-bg"
                    class="absolute top-1 left-1 w-[calc(50%-4px)] h-[calc(100%-8px)] bg-brand-600 rounded-lg transition-all duration-300 shadow-lg">
                </div>
                <button onclick="switchTab('login')"
                    class="flex-1 relative z-10 py-2.5 text-sm font-bold text-white transition-colors duration-300"
                    id="tab-login">Login</button>
                <button onclick="switchTab('register')"
                    class="flex-1 relative z-10 py-2.5 text-sm font-bold text-slate-400 transition-colors duration-300"
                    id="tab-register">Register</button>
            </div>

            <!-- Forms Container -->
            <div class="relative overflow-hidden min-h-[550px]">

                <!-- LOGIN FORM -->
                <form id="login-form"
                    class="absolute w-full transition-all duration-300 ease-out transform translate-x-0 opacity-100 space-y-5"
                    onsubmit="handleLogin(event)">
                    <div class="text-center mb-2">
                        <h2 class="text-2xl font-bold text-white">Welcome Back</h2>
                        <p class="text-slate-400 text-sm">Enter your credentials to access your account</p>
                    </div>

                    <div class="space-y-4">
                        <div class="group">
                            <label class="block text-xs font-medium text-brand-400 mb-1 ml-1">EMAIL ADDRESS</label>
                            <div class="relative">
                                <i
                                    class="fa-regular fa-envelope absolute left-4 top-3.5 text-slate-500 group-focus-within:text-brand-400 transition-colors"></i>
                                <input type="email" id="login-email" required
                                    class="input-glass w-full rounded-xl py-3 pl-11 pr-4 placeholder-slate-500"
                                    placeholder="name@example.com">
                            </div>
                        </div>
                        <div class="group">
                            <label class="block text-xs font-medium text-brand-400 mb-1 ml-1">PASSWORD</label>
                            <div class="relative">
                                <i
                                    class="fa-solid fa-lock absolute left-4 top-3.5 text-slate-500 group-focus-within:text-brand-400 transition-colors"></i>
                                <input type="password" id="login-pass" required
                                    class="input-glass w-full rounded-xl py-3 pl-11 pr-4 placeholder-slate-500"
                                    placeholder="••••••••">
                            </div>
                        </div>
                    </div>

                    <button type="submit" id="btn-login"
                        class="w-full bg-gradient-to-r from-brand-600 to-brand-500 hover:from-brand-500 hover:to-brand-400 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-brand-500/25 transform hover:-translate-y-0.5 transition-all mt-2">
                        Log In Now
                    </button>
                </form>

                <!-- REGISTER FORM -->
                <form id="register-form"
                    class="absolute w-full transition-all duration-300 ease-out transform translate-x-full opacity-0 space-y-4"
                    onsubmit="handleRegister(event)">
                    <div class="text-center mb-2">
                        <h2 class="text-2xl font-bold text-white">Create Account</h2>
                        <p class="text-slate-400 text-sm">Join us for instant digital delivery</p>
                    </div>

                    <div class="space-y-3">
                        <div class="relative">
                            <i class="fa-regular fa-user absolute left-4 top-3.5 text-slate-500"></i>
                            <input type="text" id="reg-name" required
                                class="input-glass w-full rounded-xl py-3 pl-11 pr-4 placeholder-slate-500"
                                placeholder="Full Name">
                        </div>
                        <div class="relative">
                            <i class="fa-regular fa-envelope absolute left-4 top-3.5 text-slate-500"></i>
                            <input type="email" id="reg-email" required
                                class="input-glass w-full rounded-xl py-3 pl-11 pr-4 placeholder-slate-500"
                                placeholder="Email Address">
                        </div>
                        <div class="relative">
                            <i class="fa-brands fa-whatsapp absolute left-4 top-3.5 text-slate-500"></i>
                            <input type="text" id="reg-phone" required
                                class="input-glass w-full rounded-xl py-3 pl-11 pr-4 placeholder-slate-500"
                                placeholder="Phone / WhatsApp">
                        </div>
                        <div class="relative">
                            <i class="fa-regular fa-calendar absolute left-4 top-3.5 text-slate-500"></i>
                            <input type="date" id="reg-dob" required
                                class="input-glass w-full rounded-xl py-3 pl-11 pr-4 placeholder-slate-500 text-slate-400 focus:text-white"
                                placeholder="Date of Birth">
                        </div>
                        <div class="relative">
                            <i class="fa-solid fa-lock absolute left-4 top-3.5 text-slate-500"></i>
                            <input type="password" id="reg-pass" required
                                class="input-glass w-full rounded-xl py-3 pl-11 pr-4 placeholder-slate-500"
                                placeholder="Create Password">
                        </div>
                        <div class="relative">
                            <i class="fa-solid fa-lock absolute left-4 top-3.5 text-slate-500"></i>
                            <input type="password" id="reg-confirm-pass" required
                                class="input-glass w-full rounded-xl py-3 pl-11 pr-4 placeholder-slate-500"
                                placeholder="Confirm Password">
                        </div>
                    </div>

                    <button type="submit" id="btn-reg"
                        class="w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-500 hover:to-purple-400 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-purple-500/25 transform hover:-translate-y-0.5 transition-all mt-2">
                        Create Account
                    </button>
                </form>

            </div>

            <div class="mt-6 text-center border-t border-slate-700/50 pt-6">
                <a href="index.html" class="text-slate-500 hover:text-white text-sm font-medium transition-colors">
                    <i class="fa-solid fa-arrow-left mr-2"></i> Back to Store
                </a>
            </div>
        </div>
    </div>

    </div>
    </div>

    <!-- CUSTOM ALERT MODAL -->
    <div id="custom-alert"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="glass-card w-[400px] max-w-[90%] p-6 rounded-2xl shadow-2xl transform scale-95 transition-transform duration-300"
            id="custom-alert-box">
            <div class="text-center">
                <div class="w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4"
                    id="alert-icon-bg">
                    <i class="fa-solid fa-triangle-exclamation text-2xl text-red-500" id="alert-icon"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-2" id="alert-title">Attention</h3>
                <div class="text-slate-300 text-sm leading-relaxed mb-6" id="alert-msg">
                    Something needs your attention.
                </div>
                <button onclick="closeCustomAlert()"
                    class="w-full bg-gradient-to-r from-red-600 to-red-500 hover:from-red-500 hover:to-red-400 text-white font-bold py-3 rounded-xl transition-all transform hover:scale-[1.02]"
                    id="alert-btn">
                    Understood
                </button>
            </div>
        </div>
    </div>

    <script>
        function switchTab(tab) {
            const loginForm = document.getElementById('login-form');
            const regForm = document.getElementById('register-form');
            const tabBg = document.getElementById('tab-bg');
            const btnLogin = document.getElementById('tab-login');
            const btnReg = document.getElementById('tab-register');

            if (tab === 'login') {
                // Background Slide Left
                tabBg.style.transform = 'translateX(0)';

                // Form Slide
                loginForm.style.transform = 'translateX(0)';
                loginForm.style.opacity = '1';
                regForm.style.transform = 'translateX(110%)';
                regForm.style.opacity = '0';

                // Text Colors
                btnLogin.classList.remove('text-slate-400');
                btnLogin.classList.add('text-white');
                btnReg.classList.add('text-slate-400');
                btnReg.classList.remove('text-white');
            } else {
                // Background Slide Right
                tabBg.style.transform = 'translateX(100%)';
                tabBg.style.marginLeft = '4px';

                // Form Slide
                loginForm.style.transform = 'translateX(-110%)';
                loginForm.style.opacity = '0';
                regForm.style.transform = 'translateX(0)';
                regForm.style.opacity = '1';

                // Text Colors
                btnReg.classList.remove('text-slate-400');
                btnReg.classList.add('text-white');
                btnLogin.classList.add('text-slate-400');
                btnLogin.classList.remove('text-white');
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-reg');
            const original = btn.innerText;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Creating...';
            btn.disabled = true;

            const data = {
                name: document.getElementById('reg-name').value,
                email: document.getElementById('reg-email').value,
                phone: document.getElementById('reg-phone').value,
                dob: document.getElementById('reg-dob').value,
                password: document.getElementById('reg-pass').value
            };

            // Age Validation (16+)
            if (data.dob) {
                const birthDate = new Date(data.dob);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const m = today.getMonth() - birthDate.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }

                if (age < 16) {
                    showCustomAlert("Age Restriction", "You must be at least 16 years old to create an account.", "error");
                    btn.innerHTML = original;
                    btn.disabled = false;
                    return;
                }
            } else {
                showCustomAlert("Missing Info", "Please enter your Date of Birth.", "error");
                btn.innerHTML = original;
                btn.disabled = false;
                return;
            }

            const confirmPass = document.getElementById('reg-confirm-pass').value;

            // Strong Password Validation
            const strongRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
            if (!strongRegex.test(data.password)) {
                showCustomAlert(
                    "Weak Password",
                    `<div class="text-left bg-slate-900/50 p-4 rounded-lg border border-white/5">
                        <p class="mb-2 font-bold text-red-400">Password must match these rules:</p>
                        <ul class="list-disc pl-4 space-y-1 text-xs text-slate-300">
                            <li>At least 8 characters long</li>
                            <li>One Uppercase Letter (A-Z)</li>
                            <li>One Lowercase Letter (a-z)</li>
                            <li>One Number (0-9)</li>
                            <li>One Special Character (@$!%*?&)</li>
                        </ul>
                    </div>`,
                    "error"
                );
                btn.innerHTML = original; // Fix: use innerHTML to restore text properly if needed, but original was innerText.
                btn.disabled = false;
                return;
            }

            if (data.password !== confirmPass) {
                showCustomAlert("Mismatch", "Passwords do not match! Please try again.", "error");
                btn.innerHTML = original;
                btn.disabled = false;
                return;
            }

            try {
                const res = await fetch('api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();

                if (result.success) {
                    localStorage.setItem('user', JSON.stringify(result.user));
                    window.location.href = 'profile.html';
                } else {
                    showCustomAlert("Registration Failed", result.message || "Something went wrong.", "error");
                }
            } catch (err) {
                console.error(err);
                showCustomAlert("Server Error", "Could not connect to server. Please check your internet.", "error");
            } finally {
                btn.innerHTML = original;
                btn.disabled = false;
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-login');
            const original = btn.innerText;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Checking...';
            btn.disabled = true;

            const data = {
                email: document.getElementById('login-email').value,
                password: document.getElementById('login-pass').value
            };

            try {
                const res = await fetch('api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();

                if (result.success) {
                    localStorage.setItem('user', JSON.stringify(result.user));
                    window.location.href = 'profile.html';
                } else {
                    showCustomAlert("Login Failed", result.message || "Invalid credentials.", "error");
                }
            } catch (err) {
                console.error(err);
                showCustomAlert("Server Error", "Could not connect to server. Please check your internet.", "error");
            } finally {
                btn.innerHTML = original;
                btn.disabled = false;
            }
        }

        // --- CUSTOM ALERT LOGIC ---
        function showCustomAlert(title, msg, type) {
            const modal = document.getElementById('custom-alert');
            const box = document.getElementById('custom-alert-box');
            const titleEl = document.getElementById('alert-title');
            const msgEl = document.getElementById('alert-msg');
            const icon = document.getElementById('alert-icon');
            const iconBg = document.getElementById('alert-icon-bg');
            const btn = document.getElementById('alert-btn');

            titleEl.innerText = title;
            msgEl.innerHTML = msg; // Allows HTML content

            // Type Styles
            if (type === 'error') {
                icon.className = "fa-solid fa-circle-exclamation text-2xl text-red-500";
                iconBg.className = "w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4";
                btn.className = "w-full bg-gradient-to-r from-red-600 to-red-500 hover:from-red-500 hover:to-red-400 text-white font-bold py-3 rounded-xl transition-all transform hover:scale-[1.02] shadow-lg shadow-red-500/25";
            } else if (type === 'success') {
                icon.className = "fa-solid fa-circle-check text-2xl text-emerald-500";
                iconBg.className = "w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-4";
                btn.className = "w-full bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-bold py-3 rounded-xl transition-all transform hover:scale-[1.02] shadow-lg shadow-emerald-500/25";
            } else {
                // Warning/Info
                icon.className = "fa-solid fa-triangle-exclamation text-2xl text-amber-500";
                iconBg.className = "w-16 h-16 bg-amber-500/20 rounded-full flex items-center justify-center mx-auto mb-4";
                btn.className = "w-full bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-white font-bold py-3 rounded-xl transition-all transform hover:scale-[1.02] shadow-lg shadow-amber-500/25";
            }

            modal.style.opacity = '1';
            modal.style.pointerEvents = 'auto'; // Enable clicks
            box.style.transform = 'scale(1)';
        }

        function closeCustomAlert() {
            const modal = document.getElementById('custom-alert');
            const box = document.getElementById('custom-alert-box');

            modal.style.opacity = '0';
            modal.style.pointerEvents = 'none';
            box.style.transform = 'scale(0.95)';
        }
    </script>
</body>

</html>