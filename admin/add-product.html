<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Product - Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="admin-box">
        <nav id="admin-nav"></nav>

        <!-- STOCK MANAGEMENT MODAL -->
        <div id="stock-modal" class="custom-modal-overlay" style="display:none; z-index:9999;">
            <div class="custom-modal-card" style="width:600px; max-width:95%;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3 class="modal-title" style="margin:0;"><i class="fa-solid fa-boxes-stacked"></i> Manage Stock
                    </h3>
                    <button onclick="closeStockModal()"
                        style="background:none; border:none; color:var(--gray); cursor:pointer; font-size:20px;">&times;</button>
                </div>

                <!-- Tabs -->
                <div
                    style="display:flex; gap:10px; margin-bottom:15px; border-bottom:1px solid var(--border); padding-bottom:10px;">
                    <button class="stock-tab active" onclick="switchStockTab('add')">Add Stock</button>
                    <button class="stock-tab" onclick="switchStockTab('available')">Available (<span
                            id="count-avail">0</span>)</button>
                    <button class="stock-tab" onclick="switchStockTab('sold')">Sold (<span
                            id="count-sold">0</span>)</button>
                </div>

                <!-- Tab: Add Stock -->
                <div id="tab-add" class="stock-tab-content active">
                    <label>Stock Content (Text/Code)</label>
                    <textarea id="stock-input-text" class="input-box" rows="4"
                        placeholder="Enter code, credentials, or instructions..."></textarea>

                    <label>Attachment Image (Optional)</label>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="file" id="stock-input-file" accept="image/*" class="input-box" style="margin:0;">
                        <button onclick="addStockItem()" class="btn-main" style="width:auto; padding:10px 20px;">
                            <i class="fa-solid fa-plus"></i> Add Item
                        </button>
                    </div>
                </div>

                <!-- Tab: Available -->
                <div id="tab-available" class="stock-tab-content" style="display:none;">
                    <div id="available-list" class="stock-list-container"></div>
                </div>

                <!-- Tab: Sold -->
                <div id="tab-sold" class="stock-tab-content" style="display:none;">
                    <div id="sold-list" class="stock-list-container"></div>
                </div>

                <div class="modal-actions" style="margin-top:20px; text-align:right;">
                    <button class="modal-btn confirm-success" onclick="saveStockModal()">Done</button>
                </div>
            </div>
        </div>

        <style>
            .stock-tab {
                background: none;
                border: none;
                color: var(--gray);
                padding: 8px 15px;
                cursor: pointer;
                font-weight: 500;
                border-radius: 5px;
            }

            .stock-tab.active {
                background: var(--blue);
                color: white;
            }

            .stock-list-container {
                max-height: 300px;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .stock-item {
                background: rgba(255, 255, 255, 0.05);
                padding: 10px;
                border-radius: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border: 1px solid var(--border);
            }

            .stock-item img {
                width: 40px;
                height: 40px;
                object-fit: cover;
                border-radius: 4px;
                border: 1px solid var(--border);
            }

            .stock-item-content {
                flex: 1;
                margin: 0 10px;
                font-family: monospace;
                font-size: 12px;
                color: #e2e8f0;
                white-space: pre-wrap;
                word-break: break-all;
            }

            .stock-del-btn {
                color: #ef4444;
                background: none;
                border: none;
                cursor: pointer;
            }
        </style>


        <!-- Add Product Content -->
        <div class="section active" style="display:block;">
            <h3>ðŸ“¦ New Product Setup</h3>

            <div class="grid-2" style="grid-template-columns: 2fr 1fr;">
                <div>
                    <label>Product Name</label>
                    <input type="text" id="p-name" class="input-box" placeholder="e.g. Netflix Premium">

                    <label class="text-brand-400">Custom Badge (Optional)</label>
                    <input type="text" id="p-badge" class="input-box" placeholder="e.g. HOT, 50% OFF, BEST SELLER">

                    <label>Category</label>
                    <select id="p-category" class="input-box">
                        <option value="streaming">Streaming</option>
                        <option value="tools">Tools & VPN</option>
                        <option value="gaming">Gaming</option>
                    </select>

                    <div style="margin-top:10px; margin-bottom:10px;"></div>

                    <label>Stock Status</label>
                    <select id="p-stock" class="input-box">
                        <option value="true">In Stock</option>
                        <option value="false">Out of Stock</option>
                    </select>

                    <div
                        style="margin-top:10px; display:flex; align-items:center; gap:10px; margin-bottom:15px; background:rgba(255,255,255,0.03); padding:10px; border-radius:8px; border:1px solid var(--border);">
                        <input type="checkbox" id="p-auto-stockout" style="width:20px; height:20px; cursor:pointer;">
                        <label for="p-auto-stockout"
                            style="margin:0; cursor:pointer; font-size:12px; color:var(--gray);">
                            <span style="color:white; font-weight:bold;">Auto Stockout</span><br>
                            Mark as "Out of Stock" when inventory hits 0
                        </label>
                    </div>

                    <div
                        style="margin-top:10px; display:flex; align-items:center; gap:10px; margin-bottom:15px; background:rgba(255,255,255,0.03); padding:10px; border-radius:8px; border:1px solid var(--border);">
                        <input type="checkbox" id="p-disable-paylater" style="width:20px; height:20px; cursor:pointer;">
                        <label for="p-disable-paylater"
                            style="margin:0; cursor:pointer; font-size:12px; color:var(--gray);">
                            <span style="color:white; font-weight:bold;">Disable Pay Later</span><br>
                            Force "Pay Now" only for this product
                        </label>
                    </div>
                </div>
                <div>
                    <label>Image (Upload or URL)</label>
                    <div style="border:2px dashed var(--border); border-radius:10px; padding:20px; text-align:center; position:relative;"
                        id="upload-area">
                        <div id="upload-placeholder">
                            <i class="fa-solid fa-cloud-arrow-up"
                                style="font-size:30px; color:var(--gray); margin-bottom:10px;"></i>
                            <p style="font-size:12px; color:var(--gray); margin:0;">Click or Drag Image Here</p>
                        </div>
                        <img id="preview-img"
                            style="max-width:100%; max-height:200px; border-radius:10px; display:none; margin:0 auto;">
                        <input type="file" id="p-image-file" accept="image/*, .svg"
                            style="position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer;"
                            onchange="handleFileSelect(this)">
                    </div>
                    <input type="text" id="p-img" class="input-box" placeholder="OR paste Image URL..."
                        onchange="handleUrlInput()">
                    <div id="img-preview-container"
                        style="width:100%; height:150px; background:var(--bg-main); border-radius:10px; border:1px dashed var(--border); display:flex; align-items:center; justify-content:center; overflow:hidden; margin-top:5px;">
                        <span style="color:var(--gray); font-size:12px;">No Image Selected</span>
                    </div>
                </div>
            </div>

            <label>Short Description (Card)</label>
            <input type="text" id="p-desc" class="input-box" placeholder="e.g. 4K UHD | Private Profile">

            <label>Long Description (Modal details)</label>
            <textarea id="p-long-desc" class="input-box" rows="3" placeholder="Detailed description..."></textarea>

            <label>Features (One per line)</label>
            <textarea id="p-features" class="input-box" rows="4"
                placeholder="4K Ultra HD&#10;Private Profile&#10;..."></textarea>

            <label>Instructions (After Purchase)</label>
            <textarea id="p-instructions" class="input-box" rows="2" placeholder="Delivery instructions..."></textarea>

            <!-- Variants Section -->
            <div style="background:#020617; padding:15px; border-radius:10px; margin-bottom:20px;">
                <h4 style="margin-top:0; color:var(--blue)">ðŸ·ï¸ Pricing Variants</h4>
                <div id="variants-container"></div>
                <button onclick="addVariantRow()"
                    style="background:var(--bg-card); color:white; border:1px solid var(--border); padding:8px 15px; border-radius:5px; cursor:pointer; font-size:12px;">
                    + Add Variant
                </button>
            </div>

            <!-- Auto Delivery Settings (Hidden by default, shown if price is 0) -->
            <div id="auto-delivery-section"
                style="background:rgba(16, 185, 129, 0.05); padding:15px; border-radius:10px; margin-bottom:20px; border:1px dashed var(--green); display:none;">
                <h4 style="margin-top:0; color:var(--green)">âš¡ Auto Delivery Settings (Free Product)</h4>
                <p style="font-size:12px; color:var(--gray); margin-bottom:10px;">These details will be emailed
                    automatically when a user "purchases" this item for 0.00.</p>

                <label>Delivery Text (Credentials/Code)</label>
                <textarea id="p-auto-info" class="input-box" rows="3"
                    placeholder="e.g. Secret Code: XYZ-123"></textarea>

                <label>Delivery Image (Optional)</label>
                <div style="display:flex; gap:5px; margin-bottom:5px;">
                    <input type="file" id="p-auto-img-file" accept="image/*" class="input-box"
                        style="padding:5px; font-size:12px; margin:0;" onchange="handleAutoImgUpload()">
                </div>
                <!-- Hidden input for base64 storage/url -->
                <input type="hidden" id="p-auto-img">
                <div id="auto-img-preview"
                    style="width:100%; height:100px; background:var(--bg-main); border-radius:8px; display:flex; align-items:center; justify-content:center; margin-top:5px; border:1px solid var(--border);">
                    <span style="font-size:10px; color:var(--gray);">No Image</span>
                </div>
            </div>

            <!-- Custom User Inputs Section -->
            <div
                style="background:#0f172a; padding:15px; border-radius:10px; margin-bottom:20px; border:1px solid var(--border);">
                <h4 style="margin-top:0; color:var(--brand); display:flex; align-items:center; gap:8px;">
                    <i class="fa-solid fa-list-check"></i> Custom User Inputs
                </h4>
                <p style="font-size:12px; color:var(--gray); margin-bottom:15px;">Add extra fields the user must fill
                    out during checkout (e.g. Game ID, Home Address).</p>

                <div id="custom-inputs-container"></div>

                <button type="button" onclick="addCustomInputRow()" class="action-btn"
                    style="background:var(--bg-card); color:var(--brand); border:1px dashed var(--brand); padding:8px 15px; border-radius:5px; cursor:pointer; font-size:12px; width:100%; margin-top:5px;">
                    + Add Custom Field
                </button>
            </div>

            <button class="btn-main" onclick="saveProduct()">Save Product</button>
        </div>
    </div>



    <!-- Success Modal -->
    <div id="save-success-modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); backdrop-filter:blur(5px); z-index:2000; justify-content:center; align-items:center;">
        <div
            style="background:rgba(20, 25, 40, 0.95); width:350px; padding:40px; border-radius:30px; border:1px solid rgba(255,255,255,0.1); text-align:center; animation:popIn 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); position:relative; box-shadow:0 25px 50px -12px rgba(0,0,0,0.5);">

            <!-- Animated Icon -->
            <div
                style="margin:0 auto 25px auto; width:80px; height:80px; background:linear-gradient(135deg, #10b981, #059669); border-radius:50%; display:flex; align-items:center; justify-content:center; box-shadow:0 10px 25px rgba(16,185,129,0.3); animation:pulse 2s infinite;">
                <i class="fa-solid fa-check" style="color:white; font-size:40px;"></i>
            </div>

            <h3 style="color:white; margin-top:0; font-size:24px; font-weight:700; margin-bottom:10px;"
                id="success-modal-msg">Success!
            </h3>
            <p style="color:#94a3b8; font-size:15px; margin-bottom:30px; line-height:1.5;">Changes saved successfully.
            </p>

            <!-- Timer Bar -->
            <div
                style="width:100%; background:rgba(255,255,255,0.05); height:6px; border-radius:10px; overflow:hidden; margin-bottom:15px;">
                <div id="success-timer-bar"
                    style="width:100%; height:100%; background:linear-gradient(90deg, #10b981, #34d399); border-radius:10px;">
                </div>
            </div>

            <p style="color:#64748b; font-size:12px; font-family:monospace;">Redirecting in <span
                    id="success-timer-count" style="color:#10b981; font-weight:bold;">3</span>s</p>
        </div>
    </div>

    <style>
        @keyframes popIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }

            70% {
                box-shadow: 0 0 0 15px rgba(16, 185, 129, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }
    </style>

    <!-- Custom Alert Modal -->
    <!-- Custom Alert Modal (Removed - using Global) -->

    <script src="script.js?v=5"></script>
    <script src='js/manage-product.js?v=1.6'></script>

</body>

</html>